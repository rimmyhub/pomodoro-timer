# PRD: macOS 메뉴바 Pomodoro Timer (v1.7 Final Draft)

## 0. 변경 이력
- 2026-02-14 v1.7: 캘린더 이벤트 시간은 실제 시작~실제 종료로 기록하고, 이벤트 메모에 `순집중시간(일시정지 제외) 00:xx`를 표기하도록 확정함.
- 2026-02-14 v1.7: 통계 화면은 기존대로 순집중시간 기준 집계를 유지하도록 재확인함.
- 2026-02-14 v1.6: 집중 횟수는 세션 종료일 기준 1회로 집계하고, 카테고리 관리는 메인 화면의 카테고리 버튼 경로에서만 수행하도록 확정함.
- 2026-02-14 v1.6: 삭제 카테고리 필터는 categoryId 기준 분리 + `이름 (삭제됨)` 라벨로 고정하고, 캘린더 기록도 일시정지 제외 순집중시간 기준으로 확정함.
- 2026-02-14 v1.5: 시작 전 입력은 `직접 정하기` 버튼 선택 시 노출로 확정하고, 1일 그래프 표시 범위를 선택 날짜 `00:00~24:00`로 고정함.
- 2026-02-14 v1.5: 삭제된 카테고리를 통계 필터에 `(삭제됨)` 라벨로 표시하고, 재생 중 메인/설정 모든 경로의 카테고리 API 차단 검증 항목을 확정함.
- 2026-02-14 v1.4: 카테고리 변경 금지 범위를 선택/추가/수정/삭제로 확장하고, 메인/설정 모든 진입 경로에 동일 적용 규칙을 확정함.
- 2026-02-14 v1.4: 세션 귀속은 종료일, 1일(24시간) 스택은 실제 집중 발생 시각(시 단위) 분할 규칙을 확정함.
- 2026-02-14 v1.4: 세션 저장 스키마를 categoryId + categoryNameSnapshot으로 명시하고, 카테고리 삭제 후 과거 통계 유지 정책을 고정함.
- 2026-02-14 v1.3: 카테고리/통계/캘린더 연동 요구사항을 포함한 Final Draft 정리.

## 1. 목표
메뉴바에서 빠르게 집중 타이머를 설정/실행/일시정지/초기화하고,
설정 화면에서 테마/소리/통계/캘린더 연동까지 관리할 수 있는 macOS 앱을 만든다.

## 2. 플랫폼
- macOS (설치형 앱)
- 메뉴바 앱 (`시계 옆 아이콘`)

## 3. 핵심 UX 요구사항

### FR-01 메뉴바 진입
- 메뉴바 아이콘 클릭 시 타이머 메인 화면이 열린다.
- 타이머 메인에는 `채워진 원형 타이머`가 표시된다.
- 시간 진행 시 원형 채움이 초 단위로 감소한다.

### FR-02 상단 컨트롤 위치
- 메인 화면 좌측 상단: `초기화` 버튼
- 메인 화면 좌측 상단: 초기화 옆 `카테고리` 버튼
- 메인 화면 우측 상단: `설정` 아이콘 버튼

### FR-03 시간 설정 인터랙션 (원형 다이얼)
- 사용자는 원형 내부(또는 원 테두리)에서 마우스를 클릭한 채 드래그하여 시간을 설정한다.
- 드래그 각도에 따라 원 채움이 변하며 시간값이 동기화된다.
- 각도 기준: `12시 방향 = 0`에서 시계방향으로 증가
- 설정 가능 범위: `1분 ~ 60분`
- 설정 단위: `1분`
- 재생 중에는 시간 다이얼 조작 불가

### FR-04 시간 숫자 표시
- 원형 타이머 하단에 설정/진행 중 시간 표시
- 포맷: `MM:SS` (예: `55:00`)

### FR-05 재생/일시정지 동작
- 시간 표시 아래 중앙에 `재생(삼각형)` 버튼 노출
- 재생 누르면 타이머 시작:
  - 1초마다 시간 감소
  - 원형 채움도 1초마다 감소
  - 버튼 아이콘이 `일시정지`로 변경
- 진행 중 일시정지 누르면 타이머가 멈춘다.
- 일시정지 상태에서 다시 누르면 재생 재개

### FR-06 초기화 동작
- 초기화 버튼 클릭 시 현재 타이머는 정지되고,
  마지막으로 사용자가 설정한 분 값으로 복귀한다.
- 초기화는 `현재 세션`에만 적용되며 학습 기록은 유지한다.

### FR-07 세션(업무) 입력 및 카테고리 관리
- 포모도로 시작 전 질문 문구를 노출한다: `무엇에 집중하시겠어요?`
- 시작 전 빠른 선택 옵션 3개를 제공한다:
  - `공부하기`
  - `독서하기`
  - `직접 정하기`
- `직접 정하기`를 누르면 사용자가 업무명을 직접 입력할 수 있다.
- 직접 입력 완료 시 해당 카테고리가 저장 목록에 추가된다.
- 저장된 카테고리는 이후 세션에서 다시 선택 가능하다.
- 사용자는 등록된 카테고리를 선택/수정/삭제할 수 있다.
- 카테고리 수정/삭제는 과거 학습 기록에 영향을 주지 않아야 한다(과거 세션의 카테고리 스냅샷 유지).
- 타이머 재생 중에는 카테고리 변경(선택/추가/수정/삭제)을 허용하지 않는다.
- 위 비허용 정책은 메인 화면과 설정 화면을 포함한 모든 진입 경로에 동일하게 적용한다.
- 카테고리 버튼 클릭 시 카테고리 관리(선택/수정/삭제) UI로 진입할 수 있다.
- 카테고리의 전체 관리 경로는 메인 화면 `카테고리` 버튼을 기준으로 한다.

### FR-08 설정 화면
설정 화면에는 아래 항목이 있어야 한다.
- 색상 테마 선택
- 알림음 선택
- 백색 소음 설정 (ON/OFF + 소리 선택)

사운드 정책:
- 기본값: `사운드 없음`
- 선택 옵션: `비 소리`, `카페 소리` 등 프리셋 제공

### FR-09 학습 통계 (막대그래프)
설정 화면에서 학습 기록을 막대그래프로 조회할 수 있어야 한다.
- 기간 필터: `1일`, `1주`, `1개월`, `6개월`, `1년`
- 표시 지표:
  - 집중 횟수
  - 합계 시간
- 지표는 선택한 기간 기준으로 동기화되어 표시된다.

집계 규칙:
- 로컬 시간대 기준으로 집계한다.
- 일시정지 시간은 합계 시간에서 제외한다.
- 집중 횟수는 세션 `종료일` 기준으로 세션당 1회 집계한다.
- 자정을 넘긴 세션은 종료 시점 날짜로 귀속한다.
- `1일` 24시간 스택은 세션 귀속 날짜와 별개로, 실제 집중이 발생한 시각(시 단위)으로 분할한다.
- `1일` 그래프는 선택한 날짜의 `00:00~24:00` 구간만 표시하고, 날짜 밖 시간은 제외한다.

그래프 정책:
- `1일` 보기: 막대그래프 `1개`만 표시
- 해당 1개 막대는 `시간대별 누적(스택)`으로 구성
- 시간대 분할 기준: `24시간(1시간 단위 24스택)`
- `1주 이상` 보기: 날짜 단위 막대그래프

### FR-10 통계 카테고리 필터
- 통계 화면에서 카테고리 필터를 지원한다.
- 필터 옵션:
  - 전체(All)
  - 카테고리별(사용자가 저장한 항목)
  - 삭제된 카테고리도 `이름 (삭제됨)` 라벨로 필터에서 표시
- 삭제 카테고리 필터는 `categoryId` 기준으로 원본 카테고리와 분리해 집계한다.
- 필터 적용 시 그래프/집중 횟수/합계 시간이 함께 갱신된다.

### FR-11 Apple Calendar 연동
- 설정에서 Apple Calendar 연동 ON/OFF 가능
- 연동 ON 시 완료된 집중 시간을 캘린더에서 확인 가능해야 한다.
- 1차 구현 정책:
  - 우선 기본 캘린더 1개에 이벤트 기록
  - 집중 세션 완료 시 일정(이벤트) 생성
  - 이벤트 제목 기본값: `Pomodoro Focus`
  - 이벤트 시간은 실제 시작 시각 ~ 실제 종료 시각으로 기록
  - 이벤트 메모에 카테고리(업무명)와 `순집중시간(일시정지 제외) 00:xx` 포함

## 4. 비기능 요구사항
- 타이머 정확도: 일반 사용 기준에서 1초 단위 오차가 체감되지 않아야 함
- 앱 복귀 안정성: 메뉴바 닫힘/재오픈 시 진행 상태가 유지되어야 함
- 성능: 타이머 실행 중 UI 프레임 드랍 없이 동작

## 5. 데이터 저장
- 로컬 저장 항목:
  - 마지막 설정 시간(분)
  - 타이머 상태(실행/일시정지/남은 시간)
  - 테마/알림음/백색소음 설정
  - 카테고리 목록
  - 최근 선택 카테고리
  - 학습 세션 로그(startedAt/endedAt/durationSec/categoryId/categoryNameSnapshot)
  - 통계 집계를 위한 기간별 데이터

## 6. 화면 구성 요약

### 메인(메뉴바 팝오버)
- 좌상단: 초기화
- 좌상단: 카테고리 버튼
- 중앙: 원형 타이머(드래그 설정 가능, 재생 중 조작 불가)
- 원 아래: 시간 숫자(`MM:SS`)
- 시작 전: `무엇에 집중하시겠어요?` + `공부하기/독서하기/직접 정하기`
- 하단 중앙: 재생/일시정지 버튼
- 우상단: 설정

### 설정
- 테마
- 알림음
- 백색 소음
- 카테고리 관리는 제공하지 않음(메인 화면 `카테고리` 버튼에서만 관리)
- 학습 통계(막대그래프 + 기간 필터 + 카테고리 필터)
- Apple Calendar 연동

## 7. 완료 기준 (Acceptance Criteria)
1. 60분 설정 후 재생 시 `59:59`부터 초 단위 감소한다.
2. 진행 중 일시정지 후 10초 대기해도 시간이 변하지 않는다.
3. 재생 재개 시 멈춘 시점부터 다시 감소한다.
4. 초기화 클릭 시 마지막 설정값으로 즉시 복귀하고 기록은 유지된다.
5. 재생 중 다이얼 드래그 입력은 반영되지 않는다.
6. 시작 전 질문 `무엇에 집중하시겠어요?`와 3개 옵션이 표시된다.
7. `직접 정하기` 입력 완료 시 카테고리가 저장 목록에 추가된다.
8. 카테고리 버튼을 통해 등록 카테고리 선택/수정/삭제가 가능하다.
9. 1일 통계에서 단일 누적 막대(24시간 스택)로 표시된다.
10. 통계 카테고리 필터 적용 시 그래프/집계 수치가 동기화 갱신된다.
11. Apple Calendar 연동 ON 상태에서 세션 완료 시 캘린더 이벤트 확인 가능하다.
12. 카테고리를 수정/삭제해도 과거 통계 값은 변하지 않는다.
13. 통계 합계 시간은 일시정지 구간을 제외하고, 자정 넘김 세션은 종료 날짜에 반영된다.
14. 1일(24시간) 스택 그래프는 실제 집중 발생 시각(시 단위) 기준으로 분할된다.
15. 1일 그래프는 선택 날짜 `00:00~24:00` 범위만 표시하고, 범위 밖 시간은 제외된다.
16. 재생 중에는 메인/설정 모든 경로에서 카테고리 선택/추가/수정/삭제 API가 차단된다.
17. 집중 횟수는 세션 종료일 기준으로 세션당 1회 집계된다.
18. 삭제 카테고리 필터는 `categoryId` 기준으로 분리되며 `이름 (삭제됨)`으로 표시된다.
19. 캘린더 이벤트 시간은 실제 시작~실제 종료로 기록된다.
20. 캘린더 이벤트 메모에는 `순집중시간(일시정지 제외) 00:xx`가 포함된다.

## 8. 결정 사항
- 1일 통계 그래프: 단일 막대 1개 + 24시간(1시간 단위) 스택
- 시작 전 입력 UX: `직접 정하기` 버튼 선택 시 입력창 노출
- 시작 전 기본 빠른 선택: `공부하기`, `독서하기`, `직접 정하기`
- `직접 정하기` 입력 완료 시 카테고리 자동 추가
- 카테고리 전체 관리 경로: 메인 화면 `카테고리` 버튼
- 재생 중 다이얼 조작: 비허용
- 재생 중 카테고리 변경(선택/추가/수정/삭제): 비허용
- 재생 중 카테고리 변경 금지 정책은 메인/설정 모든 진입 경로에 동일 적용
- 카테고리 수정/삭제 후 과거 통계: 유지(세션 스냅샷 유지)
- 통계 집계 기준: 로컬 시간대, 일시정지 제외, 자정 넘김은 종료일 귀속
- 집중 횟수 집계 기준: 세션 종료일 기준, 세션당 1회
- 1일 스택 분할 기준: 실제 집중 발생 시각(시 단위)
- 1일 그래프 표시 범위: 선택 날짜 `00:00~24:00`(범위 밖 제외)
- 삭제 카테고리 필터 기준: `categoryId` 분리, 라벨 `이름 (삭제됨)`
- 캘린더 기록 기준: 이벤트 시간은 실제 시작~실제 종료, 메모에 순집중시간 표기
- 사운드 기본값: 없음
