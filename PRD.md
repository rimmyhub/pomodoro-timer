# PRD: PomodoroBuddy (Current Spec v1.0.2)

## 0. 변경 이력
- 2026-02-18 v1.0.2: 현행 구현 기준으로 문서 전면 현행화.
- 2026-02-18 v1.0.2: 설정 화면 사운드 변경 시 종료되던 크래시 수정 사항 반영.

## 1. 제품 목표
macOS 메뉴바에서 빠르게 포모도로를 실행하고, 카테고리 기반으로 집중 기록을 남기며, 통계를 확인할 수 있는 경량 앱을 제공한다.

## 2. 대상 플랫폼
- macOS 13+
- 메뉴바 앱 (`LSUIElement=true`, Dock 아이콘 없음)
- 설치형 `.app` 번들 배포

## 3. 범위 정의
### In Scope (v1.0.2)
- 메뉴바 타이머 실행/일시정지/초기화
- 원형 다이얼 시간 설정(1~60분)
- 카테고리 선택/추가/수정/삭제(고정 카테고리 보호)
- 휴식 사이클(자동 전환) 설정
- 테마/알림음/BGM 설정
- 세션 통계(기간/카테고리 필터)
- 로컬 저장(UserDefaults)
- 릴리즈 zip 패키징 스크립트

### Out of Scope (v1.0.2)
- Apple Calendar 연동(EventKit)
- 시작 전 `무엇에 집중하시겠어요?` 3버튼(공부/독서/직접정하기) UX
- 원격 동기화/계정 기능

## 4. 기능 요구사항

### FR-01 메뉴바 진입 및 창 구성
- 메뉴바 아이콘 클릭 시 메인 타이머 창이 열린다.
- 별도 창으로 `카테고리`, `학습 통계`, `설정` 창을 연다.
- 보조 창은 플로팅 레벨로 표시된다.

### FR-02 메인 타이머 화면
- 상단 좌측: `초기화`, `카테고리`
- 상단 우측: `통계`, `설정`
- 중앙: 원형 다이얼 + `MM:SS` 텍스트
- 하단 중앙: 재생/일시정지 버튼
- 선택된 카테고리명을 칩 형태로 표시한다.

### FR-03 시간 설정(다이얼)
- 드래그 각도로 분 값을 설정한다.
- 범위는 1~60분, 1분 단위다.
- 세션 진행 중(실행/일시정지 포함)에는 다이얼 조작이 잠긴다.

### FR-04 타이머 동작
- 재생 시 1초 단위로 감소한다.
- 일시정지 후 재개 시 남은 시간에서 이어진다.
- 초기화 시 현재 구성 분(`configuredMinutes`) 기준으로 복귀한다.
- 세션 시작 시점부터 카테고리/설정 수정 잠금이 활성화되고, 초기화 후 잠금이 해제된다.

### FR-05 카테고리 관리
- 기본 고정 카테고리: `휴식`, `공부하기` (자동 보정)
- 카테고리 창에서 추가/수정/삭제/선택/저장을 제공한다.
- 고정 카테고리는 삭제/수정 불가다.
- 동일 이름(대소문자 무시) 중복 추가를 방지한다.
- 세션 활성 상태에서는 카테고리 편집 기능이 비활성화된다.

### FR-06 설정 화면
- 항목:
  - 휴식 시간 주기 ON/OFF
  - 휴식 시간(분, 1~60)
  - 알림음 선택(수업종1/수업종2/수업종3)
  - BGM 선택(없음/비 소리/장작 타는 소리)
  - 테마 선택
- 하단 액션:
  - `닫기`
  - `저장`
  - `앱 종료`
- 세션 활성 상태에서는 설정 편집/저장 기능이 비활성화된다.

### FR-07 휴식 사이클 동작
- 업무 카테고리 세션 종료 후 `휴식 시간 주기`가 켜져 있으면 `휴식` 카테고리와 휴식 분으로 자동 전환된다.
- 휴식 세션 종료 후에는 직전 업무 카테고리/분으로 복귀한다.

### FR-08 통계 화면
- 기간 필터: `1일`, `1주`, `1개월`, `6개월`, `1년`
- 카테고리 필터: `전체`, 현재 카테고리, 삭제된 카테고리(`이름 (삭제됨)`)
- 요약 지표: 집중 횟수, 합계 시간
- 차트:
  - `1일`: 당일 24개 시간대 막대(00~23시), 세그먼트 겹침 기준 집계
  - `1주`: 최근 7일 일자 막대
  - `1개월`: 이번 달 일자 막대
  - `6개월/1년`: 월 단위 막대

### FR-09 사운드 동작 및 안정성
- 완료 알림음과 BGM 재생을 지원한다.
- 설정에서 알림음/BGM 프리뷰를 지원한다.
- 사운드 파일 탐색은 실행 환경에 따라 `Bundle.main` 및 리소스 하위 `.bundle`들을 동적으로 탐색한다.
- 리소스 미탐색 시 앱 종료 없이 안전하게 fallback(`NSSound.beep`) 처리한다.

### FR-10 로컬 저장
- UserDefaults 키:
  - `app.settings`
  - `app.categories`
  - `app.sessions`
  - `app.selectedCategoryID`
- 저장 대상:
  - 설정(AppSettings)
  - 카테고리 목록
  - 세션 로그(segments 포함)
  - 마지막 선택 카테고리

## 5. 비기능 요구사항
- 타이머 정확도: 체감 가능한 오차 없이 초 단위 동작
- 안정성: 설정 변경(특히 사운드 변경) 시 비정상 종료가 없어야 함
- 복구성: 앱 재실행 시 설정/카테고리/세션 기록 복원
- 성능: 일반 사용에서 UI 응답 지연이 없어야 함

## 6. 데이터 모델
- `Category`
  - `id`, `name`, `createdAt`, `updatedAt`
- `FocusSegment`
  - `start`, `end`
- `FocusSession`
  - `id`, `startedAt`, `endedAt`, `durationSec`
  - `categoryId`, `categoryNameSnapshot`
  - `segments`
- `AppSettings`
  - `defaultMinutes`, `breakMinutes`, `breakCycleEnabled`
  - `theme`, `notificationSound`
  - `whiteNoiseEnabled`, `whiteNoiseTrack`

## 7. 기본값 정책
- 기본 집중 시간: 25분
- 기본 휴식 시간: 5분
- 휴식 사이클: ON
- 기본 테마: tomato
- 기본 알림음: 수업종1(`clearBell`)
- BGM 기본: OFF, 트랙 기본값 `rain`

## 8. 완료 기준 (Acceptance Criteria)
1. 다이얼로 1~60분 설정이 가능하고, 실행 중에는 변경되지 않는다.
2. 재생 시 1초 단위로 시간이 감소하고, 일시정지 시 시간이 멈춘다.
3. 초기화 시 현재 구성 분으로 즉시 복귀한다.
4. 세션 활성 상태에서 카테고리/설정 편집이 잠긴다.
5. 카테고리 창에서 고정 카테고리는 삭제/수정할 수 없다.
6. 중복 카테고리명이 생성되지 않는다(대소문자 무시).
7. 휴식 사이클 ON일 때 업무 종료 후 `휴식`으로 자동 전환된다.
8. 휴식 종료 후 이전 업무 카테고리/분으로 복귀한다.
9. 통계 기간/카테고리 필터 변경 시 요약 수치와 차트가 함께 갱신된다.
10. 삭제된 카테고리 기록이 `(삭제됨)` 라벨로 필터에 노출된다.
11. 설정에서 알림음/BGM 변경 시 앱이 종료되지 않는다.
12. 앱 재실행 후 설정/카테고리/세션 기록이 유지된다.

## 9. 릴리즈/배포 기준
- 릴리즈 산출물: `PomodoroBuddy-macOS-v<version>.zip`
- 릴리즈 스크립트:
  - `scripts/build_app_bundle.sh`
  - `scripts/build_release_zip.sh`
- 릴리즈 노트는 별도 파일(`RELEASE_NOTES_v<version>.md`)로 관리한다.

